<%= javascript_pack_tag 'qrcode' %>
<p id="notice"><%= notice %></p>
<section class="section">
  <div class="container">
    <div class="content">
      <div class="level">
        <div class="level-left">
          <div class="level-item">
            <p class="title"><%= @patient.full_name %></p>
          </div>
          <div class="is-grouped">
            <%= link_to 'Edit', edit_patient_path(@patient), class: 'button is-info is-light' %> 
            <%= link_to 'Download Health Card', patient_health_card_path(@patient, format: 'smart-health-card'), class: 'button is-info is-light' %>
            <%= form_with url: patient_health_card_path(@patient, format: 'pdf'), class: 'button is-info is-light', method: :post do |f| %>        
              <%= f.hidden_field :qrcode, id: 'qr-code-field' %>
              <%= f.submit 'Download PDF', id:'download-pdf-button', class: 'button is-info is-light' %>
            <% end %>
          </div>
        </div>
      </div>
      <div class="block">
        <span class="has-text-weight-bold mr-2">Gender:</span><span><%= @patient.gender %></span>
      </div>
      <div class="block">
        <span class="has-text-weight-bold mr-2">Birth Date:</span><span><%= format_date(@patient.birth_date) %></span>
      </div>
      <div class="block">
        <span class="has-text-weight-bold mr-2">Phone:</span><span><%= number_to_phone(@patient.phone) %></span>
      </div>
      <div class="block">
        <span class="has-text-weight-bold mr-2">Email:</span><span><%= @patient.email %></span>
      </div>
      <div class="block">
        <span class="has-text-weight-bold mr-2">Address:</span><span><%= show_address(@patient) %></span>
      </div>
      <div class="level">
        <div class="level-left">
          <% if @patient.immunizations.present? %>
            <div class="level-item">
              <p class="title">Immunizations</p>
            </div>
          <% end %>
          <div class="level-item">
            <%= link_to 'Record Immunization', new_patient_immunization_path(@patient), class: 'button is-success' %>
          </div>
        </div>
      </div>
      <div class="tile is-ancestor">
        <% @patient.immunizations.each do |i| %>
          <div class="tile is-parent">
            <div class="tile is-child box">
              <div class="block">
                <span class="has-text-weight-bold"><%= i.vaccine.name %></span>
              </div>
              <div class="block">
                <span class="mr-2 has-text-weight-bold">Date:</span><span><%= format_date(i.occurrence) %></span>
              </div>
              <div class="block">
                <span class="mr-2 has-text-weight-bold">Lot:</span><span><%= i.lot_number %> </span>
              </div>
              <div class="block">
                <%= link_to 'Edit', edit_patient_immunization_path(@patient, i), class: 'button is-info is-light mr-2' %>
                <%= link_to 'Destroy', patient_immunization_path(@patient, i), method: :delete, data: { confirm: 'Are you sure?' }, class: 'button is-danger is-outlined' %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
    <div id="qr-code"></div>
    <%= link_to 'Patient List', patients_path, class: 'button is-info' %>
  </div>
</section>

<script>
  {
    const downloadButton = document.querySelector('#download-pdf-button');
    downloadButton.onclick = () => {
      // Disable elements on page after download button has been clicked
      const container = document.querySelector('.container');
      container.style['pointer-events'] = 'none';
    }
  }
</script>
